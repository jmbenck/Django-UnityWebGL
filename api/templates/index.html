{%load static%}
<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>Unity WebGL Player | MinisterioGame</title>
    <link href="{% static 'TemplateData/favicon.ico'%}" rel="shortcut icon">
    <link href="{% static 'TemplateData/style.css'%}" rel="stylesheet">
    <script src="{% static 'TemplateData/UnityProgress.js'%}"></script>
    <script src="{% static 'Build/UnityLoader.js'%}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

   {% csrf_token %}

    <h1>Id do usuario: {{user.id}}</h1>
    <script>
  var gameInstance = UnityLoader.instantiate("gameContainer", "{% static 'Build/build.json'%}", {onProgress: UnityProgress});
  var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
  var id = {{user.id }};

  window.Unity = {
    JanelaCarregada() {
      console.log('Pagina says: carregou janela Unity');

      gameInstance.SendMessage('Main Camera', 'SendID', id);
    },
    SalvaPontucao(pontos) {
      console.log('Pagina says: salvando pontuacao ' + pontos);
      var apiKey = "20d2b46856379b6d10df9731d259c0ad15119019";
      $.ajax({

          url: 'http://159.203.79.216:8000/api/usuario/2/',
          contentType: 'application/json',
          cache: false,
          method: 'PATCH',
          dataType: 'json',
          data: "{'pontuacao': 420")},
          headers: { "Authorization": apiKey ,
          "Access-Control-Allow-Methods": "GET, POST, PATCH, PUT, DELETE",
           'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')},
          success: function(data) {
              console.log(data);
          }
      });
    }
  }


    </script>
</head>
<body>
<div class="webgl-content">
    <div id="gameContainer" style="width: 960px; height: 600px"></div>
    <div class="footer">
        <div class="webgl-logo"></div>
        <div class="fullscreen" onclick="gameInstance.SetFullscreen(1)"></div>
        <div class="title">MinisterioGame</div>
    </div>
</div>
</body>
</html>
